<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="伊﨑 直志" />


<title>Week4 | Rによる自主勉強会</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="site_style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Naoshi <strong>ISAKI</strong></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="univ.html">Univ.</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="js_test.html">jsのテスト</a>
</li>
<li>
  <a href="html_gene.html">Rでhtml生成</a>
</li>
<li>
  <a href="id_class_check.html">タグチェック用</a>
</li>
<li>
  <a href="grid_test.html">gridレイアウト用</a>
</li>
<li>
  <a href="css_test.html">cssチェック用</a>
</li>
<li>
  <a href="rstudy.html">R勉強会</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Week4 | Rによる自主勉強会</h1>
<h4 class="author">伊﨑 直志</h4>
<h4 class="date">2023年11月17日</h4>

</div>


<div id="準備" class="section level1">
<h1>準備</h1>
<div id="loading-packages" class="section level2">
<h2>Loading Packages</h2>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: パッケージ &#39;tidyverse&#39; はバージョン 4.1.3 の R の下で造られました</code></pre>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.2 --
## v ggplot2 3.3.5      v purrr   0.3.4 
## v tibble  3.1.8      v dplyr   1.0.10
## v tidyr   1.2.0      v stringr 1.4.0 
## v readr   2.1.2      v forcats 0.5.1</code></pre>
<pre><code>## Warning: パッケージ &#39;ggplot2&#39; はバージョン 4.1.2 の R の下で造られました</code></pre>
<pre><code>## Warning: パッケージ &#39;tidyr&#39; はバージョン 4.1.3 の R の下で造られました</code></pre>
<pre><code>## Warning: パッケージ &#39;readr&#39; はバージョン 4.1.3 の R の下で造られました</code></pre>
<pre><code>## Warning: パッケージ &#39;dplyr&#39; はバージョン 4.1.3 の R の下で造られました</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(dplyr)
library(gridExtra)</code></pre>
<pre><code>## 
##  次のパッケージを付け加えます: &#39;gridExtra&#39; 
## 
##  以下のオブジェクトは &#39;package:dplyr&#39; からマスクされています: 
## 
##      combine</code></pre>
<pre class="r"><code>library(readr)
library(lubridate)</code></pre>
<pre><code>## Warning: パッケージ &#39;lubridate&#39; はバージョン 4.1.3 の R の下で造られました</code></pre>
<pre><code>## 
##  次のパッケージを付け加えます: &#39;lubridate&#39; 
## 
##  以下のオブジェクトは &#39;package:base&#39; からマスクされています: 
## 
##      date, intersect, setdiff, union</code></pre>
<pre class="r"><code>windowsFonts(family_sans = windowsFont(&quot;Noto Sans JP Regular&quot;)) 
par(family = &quot;family_sans&quot;)
knitr::opts_chunk$set(echo = TRUE)</code></pre>
</div>
</div>
<div id="第4章-回帰分析の基礎" class="section level1">
<h1>第4章　回帰分析の基礎</h1>
<div id="回帰分析の考え方" class="section level2">
<h2>4.1. 回帰分析の考え方</h2>
<div id="回帰予測" class="section level3">
<h3>4.1.1. 回帰＝予測</h3>
<p>回帰：「興味のある変数yの値を、他の変数xを用いて予測すること」</p>
<p>x-説明変数、独立変数</p>
<p>y-被説明変数、従属変数</p>
<p>回帰関数 regression function：xを用いて予測されたyの値 m(x)</p>
<p>誤差項 error term：回帰関数m(x)による予測の誤差 y-m(x)</p>
</div>
<div id="最小二乗法-least-squares-estimation" class="section level3">
<h3>4.1.2. 最小二乗法 least squares estimation</h3>
<p>（例）教育年数xから賃金yを予測</p>
<p>予測誤差 prediction error をできるだけ小さく</p>
<p>⇒平均二乗誤差 mean squared errors: MSE</p>
</div>
<div id="条件付期待値と回帰分析" class="section level3">
<h3>4.1.3. 条件付期待値と回帰分析</h3>
</div>
<div id="数値例気温と電力使用量" class="section level3">
<h3>4.1.4. 数値例：気温と電力使用量</h3>
<pre class="r"><code>tempdata &lt;- read_csv(&quot;temperature_aug.csv&quot;)</code></pre>
<pre><code>## Rows: 744 Columns: 5
## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## chr (1): date
## dbl (4): time, elec, prec, temp
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>ggplot(tempdata, aes(x = time, y = temp)) +
  geom_point() +
  labs(title = &quot;図4.2 2014年8月の東京都における時刻と気温&quot;, x = &quot;時刻&quot;, y = &quot;気温&quot;) +
  theme_bw(base_family = &quot;family_sans&quot;) +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>
<div id="データフレームとティブル" class="section level3">
<h3>4.1.5. データフレームとティブル</h3>
<pre class="r"><code>head(tempdata) #データフレーム：項目名と番号という枠（フレーム）を備えた、さまざまな属性のデータの塊</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="right">time</th>
<th align="right">elec</th>
<th align="right">prec</th>
<th align="right">temp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2014/8/1</td>
<td align="right">0</td>
<td align="right">3193</td>
<td align="right">0</td>
<td align="right">27.9</td>
</tr>
<tr class="even">
<td align="left">2014/8/1</td>
<td align="right">1</td>
<td align="right">2960</td>
<td align="right">0</td>
<td align="right">27.9</td>
</tr>
<tr class="odd">
<td align="left">2014/8/1</td>
<td align="right">2</td>
<td align="right">2807</td>
<td align="right">0</td>
<td align="right">27.1</td>
</tr>
<tr class="even">
<td align="left">2014/8/1</td>
<td align="right">3</td>
<td align="right">2748</td>
<td align="right">0</td>
<td align="right">26.8</td>
</tr>
<tr class="odd">
<td align="left">2014/8/1</td>
<td align="right">4</td>
<td align="right">2735</td>
<td align="right">0</td>
<td align="right">26.9</td>
</tr>
<tr class="even">
<td align="left">2014/8/1</td>
<td align="right">5</td>
<td align="right">2736</td>
<td align="right">0</td>
<td align="right">27.3</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>print(tempdata, n = 100)</code></pre>
<pre><code>## # A tibble: 744 x 5
##     date      time  elec  prec  temp
##     &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##   1 2014/8/1     0  3193     0  27.9
##   2 2014/8/1     1  2960     0  27.9
##   3 2014/8/1     2  2807     0  27.1
##   4 2014/8/1     3  2748     0  26.8
##   5 2014/8/1     4  2735     0  26.9
##   6 2014/8/1     5  2736     0  27.3
##   7 2014/8/1     6  2950     0  28.3
##   8 2014/8/1     7  3336     0  29.4
##   9 2014/8/1     8  3863     0  30.2
##  10 2014/8/1     9  4328     0  32.2
##  11 2014/8/1    10  4520     0  32.6
##  12 2014/8/1    11  4679     0  32.7
##  13 2014/8/1    12  4612     0  32.4
##  14 2014/8/1    13  4737     0  32.8
##  15 2014/8/1    14  4728     0  32.7
##  16 2014/8/1    15  4690     0  32.3
##  17 2014/8/1    16  4631     0  31.5
##  18 2014/8/1    17  4454     0  30.5
##  19 2014/8/1    18  4397     0  29.5
##  20 2014/8/1    19  4313     0  28.9
##  21 2014/8/1    20  4069     0  29.8
##  22 2014/8/1    21  3817     0  29  
##  23 2014/8/1    22  3671     0  28  
##  24 2014/8/1    23  3411     0  27.9
##  25 2014/8/2     0  3107     0  27.9
##  26 2014/8/2     1  2876     0  27.3
##  27 2014/8/2     2  2737     0  27.5
##  28 2014/8/2     3  2682     0  27.5
##  29 2014/8/2     4  2658     0  27.3
##  30 2014/8/2     5  2599     0  27.6
##  31 2014/8/2     6  2739     0  29.2
##  32 2014/8/2     7  3015     0  30.5
##  33 2014/8/2     8  3444     0  31.4
##  34 2014/8/2     9  3839     0  31.9
##  35 2014/8/2    10  4036     0  33.3
##  36 2014/8/2    11  4203     0  33.3
##  37 2014/8/2    12  4244     0  34.1
##  38 2014/8/2    13  4322     0  34.6
##  39 2014/8/2    14  4334     0  33.9
##  40 2014/8/2    15  4294     0  33.1
##  41 2014/8/2    16  4223     0  33.2
##  42 2014/8/2    17  4108     0  32.9
##  43 2014/8/2    18  4116     0  31.9
##  44 2014/8/2    19  4120     0  31.5
##  45 2014/8/2    20  3964     0  31.5
##  46 2014/8/2    21  3797     0  31  
##  47 2014/8/2    22  3674     0  30.4
##  48 2014/8/2    23  3425     0  29.8
##  49 2014/8/3     0  3119     0  29.3
##  50 2014/8/3     1  2874     0  29.3
##  51 2014/8/3     2  2716     0  28.2
##  52 2014/8/3     3  2651     0  28.3
##  53 2014/8/3     4  2616     0  28.5
##  54 2014/8/3     5  2569     0  28.4
##  55 2014/8/3     6  2685     0  29.3
##  56 2014/8/3     7  2947     0  30.4
##  57 2014/8/3     8  3309     0  32  
##  58 2014/8/3     9  3675     0  32.8
##  59 2014/8/3    10  3861     0  33.2
##  60 2014/8/3    11  3982     0  33.6
##  61 2014/8/3    12  4052     0  35  
##  62 2014/8/3    13  4067     0  35.2
##  63 2014/8/3    14  4046     0  33.2
##  64 2014/8/3    15  3988     0  32.2
##  65 2014/8/3    16  3950     0  31.7
##  66 2014/8/3    17  3936     0  31.9
##  67 2014/8/3    18  4031     0  31  
##  68 2014/8/3    19  4093     0  30.7
##  69 2014/8/3    20  3957     0  30.4
##  70 2014/8/3    21  3800     0  29.8
##  71 2014/8/3    22  3612     0  29.6
##  72 2014/8/3    23  3343     0  29.4
##  73 2014/8/4     0  3046     0  28.7
##  74 2014/8/4     1  2824     0  28.5
##  75 2014/8/4     2  2699     0  28.3
##  76 2014/8/4     3  2663     0  28.1
##  77 2014/8/4     4  2665     0  27.9
##  78 2014/8/4     5  2691     0  28.4
##  79 2014/8/4     6  2961     0  29.1
##  80 2014/8/4     7  3387     0  30.5
##  81 2014/8/4     8  3992     0  31.2
##  82 2014/8/4     9  4468     0  32.7
##  83 2014/8/4    10  4660     0  33.2
##  84 2014/8/4    11  4761     0  32.7
##  85 2014/8/4    12  4660     0  34.1
##  86 2014/8/4    13  4727     0  32.7
##  87 2014/8/4    14  4692     0  32  
##  88 2014/8/4    15  4649     0  31.9
##  89 2014/8/4    16  4662     0  31.5
##  90 2014/8/4    17  4516     0  31.6
##  91 2014/8/4    18  4503     0  31.1
##  92 2014/8/4    19  4463     0  30.5
##  93 2014/8/4    20  4234     0  29.8
##  94 2014/8/4    21  3997     0  29.1
##  95 2014/8/4    22  3837     0  28.7
##  96 2014/8/4    23  3552     0  28.7
##  97 2014/8/5     0  3214     0  28.7
##  98 2014/8/5     1  2978     0  28.5
##  99 2014/8/5     2  2845     0  28.2
## 100 2014/8/5     3  2793     0  28.3
## # ... with 644 more rows
## # i Use `print(n = ...)` to see more rows</code></pre>
<pre class="r"><code>#特定の行や列を抽出 [行, 列]
tempdata[3, ]</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="right">time</th>
<th align="right">elec</th>
<th align="right">prec</th>
<th align="right">temp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2014/8/1</td>
<td align="right">2</td>
<td align="right">2807</td>
<td align="right">0</td>
<td align="right">27.1</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>head(tempdata[, 2])</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">5</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>tempdata[3, 2]</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>tempdata$time</code></pre>
<pre><code>##   [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0
##  [26]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1
##  [51]  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2
##  [76]  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3
## [101]  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4
## [126]  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5
## [151]  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6
## [176]  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7
## [201]  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8
## [226]  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9
## [251] 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10
## [276] 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11
## [301] 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12
## [326] 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13
## [351] 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14
## [376] 15 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15
## [401] 16 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16
## [426] 17 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17
## [451] 18 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18
## [476] 19 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19
## [501] 20 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
## [526] 21 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21
## [551] 22 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22
## [576] 23  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
## [601]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0
## [626]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1
## [651]  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2
## [676]  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3
## [701]  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  0  1  2  3  4
## [726]  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23</code></pre>
<pre class="r"><code>tempdata$time[3]</code></pre>
<pre><code>## [1] 2</code></pre>
</div>
<div id="ノンパラメトリック回帰の実行" class="section level3">
<h3>4.1.6. ノンパラメトリック回帰の実行</h3>
<pre class="r"><code>tempdata %&gt;% 
  summarise(mean_temp = mean(temp))</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">mean_temp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">27.66841</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>tempdata %&gt;% 
  summarise(mean_temp = mean(temp),
            sd_temp   = sd(temp),
            max_temp  = max(temp),
            min_temp  = min(temp))</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">mean_temp</th>
<th align="right">sd_temp</th>
<th align="right">max_temp</th>
<th align="right">min_temp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">27.66841</td>
<td align="right">3.545453</td>
<td align="right">35.5</td>
<td align="right">19.8</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>tempdata %&gt;%
  group_by(time) %&gt;% 
  summarise(mean_temp = mean(temp))</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">time</th>
<th align="right">mean_temp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">26.36129</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">26.09677</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">25.89677</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">25.83548</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">25.72581</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">25.83226</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">26.42581</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">27.25806</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">28.13548</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">29.03871</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">29.42258</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="right">29.62258</td>
</tr>
<tr class="odd">
<td align="right">12</td>
<td align="right">29.87419</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">30.03871</td>
</tr>
<tr class="odd">
<td align="right">14</td>
<td align="right">29.70645</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">29.30968</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">28.88065</td>
</tr>
<tr class="even">
<td align="right">17</td>
<td align="right">28.29032</td>
</tr>
<tr class="odd">
<td align="right">18</td>
<td align="right">27.71613</td>
</tr>
<tr class="even">
<td align="right">19</td>
<td align="right">27.45484</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">27.18710</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">26.93871</td>
</tr>
<tr class="odd">
<td align="right">22</td>
<td align="right">26.62903</td>
</tr>
<tr class="even">
<td align="right">23</td>
<td align="right">26.36452</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>tempdata %&gt;%
  group_by(time) %&gt;%
  summarise(mean_temp = mean(temp)) %&gt;%
  ggplot(aes(x = time, y = mean_temp)) +
  geom_line() +
  labs(title = &quot;図4.3　ノンパラメトリック回帰の結果&quot;, x = &quot;時間&quot;, y = &quot;気温&quot;) + 
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>tempdata %&gt;% 
  ggplot(aes(x = time, y = temp)) +
  stat_summary(geom = &quot;line&quot;, fun = &quot;mean&quot;) + #stat_summary(geom = , fun = ): 引数yに与えられた変数を対象にして、統計量を計算して描画
  labs(title = &quot;図4.3&#39;　ノンパラメトリック回帰の結果&quot;, x = &quot;時間&quot;, y = &quot;気温&quot;) + 
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
</div>
<div id="グラフを重ねる" class="section level3">
<h3>4.1.7. グラフを重ねる</h3>
<pre class="r"><code>tempdata %&gt;% 
  ggplot(aes(x = time, y = temp)) +
  geom_point() +
  stat_summary(geom = &quot;line&quot;, fun = &quot;mean&quot;) +
  labs(title = &quot;図4.4　回帰曲線と散布図の関係&quot;, x = &quot;時間&quot;, y = &quot;気温&quot;) + 
  coord_cartesian(ylim = c(20, 30)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
</div>
<div id="単回帰分析" class="section level2">
<h2>4.2. 単回帰分析</h2>
<div id="ノンパラメトリック回帰の限界" class="section level3">
<h3>4.2.1. ノンパラメトリック回帰の限界</h3>
<pre class="r"><code>with(tempdata, cor(temp, elec))</code></pre>
<pre><code>## [1] 0.7198181</code></pre>
<pre class="r"><code>tempdata %&gt;% 
  summarise(cor(temp, elec))</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">cor(temp, elec)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.7198181</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>tempdata %&gt;% 
  with(cor(temp, elec))</code></pre>
<pre><code>## [1] 0.7198181</code></pre>
<pre class="r"><code>tempdata %&gt;% 
  ggplot(aes(x = temp, y = elec)) +
  stat_summary(geom = &quot;line&quot;, fun = &quot;mean&quot;) + 
  labs(title = &quot;図4.6　電気使用量の回帰曲線&quot;,
       x = &quot;電気使用量の回帰曲線&quot;, y = &quot;電気使用量（万kw）&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="単回帰の計算方法" class="section level3">
<h3>4.2.3. 単回帰の計算方法</h3>
<p>（略）</p>
</div>
<div id="rによる線形回帰分析" class="section level3">
<h3>4.2.4. Rによる線形回帰分析</h3>
<pre class="r"><code>lm(elec ~ temp, data = tempdata)</code></pre>
<pre><code>## 
## Call:
## lm(formula = elec ~ temp, data = tempdata)
## 
## Coefficients:
## (Intercept)         temp  
##      -614.3        145.0</code></pre>
</div>
<div id="推定量と推定値" class="section level3">
<h3>4.2.5. 推定量と推定値</h3>
</div>
<div id="単回帰の図示" class="section level3">
<h3>4.2.6. 単回帰の図示</h3>
<pre class="r"><code>result &lt;- lm(elec ~ temp,
             data = tempdata)
result$coefficients</code></pre>
<pre><code>## (Intercept)        temp 
##   -614.2722    145.0303</code></pre>
<pre class="r"><code>tempdata %&gt;% 
  ggplot(aes(x = temp, y = elec)) +
  geom_point() +
  geom_abline(intercept = result$coefficients[1],
              slope     = result$coefficients[2]) +
  labs(title = &quot;図4.7　単回帰の結果&quot;, x =&quot;気温&quot;, y = &quot;電気使用量（万kw）&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
</div>
<div id="重回帰分析" class="section level2">
<h2>4.3. 重回帰分析</h2>
<div id="説明変数を追加する" class="section level3">
<h3>4.3.1. 説明変数を追加する</h3>
<pre class="r"><code>tempdata %&gt;% 
  ggplot(aes(x = time, y = elec)) +
  geom_point() +
  labs(title = &quot;図4.8　電力使用量の時間推移&quot;, x = &quot;時刻&quot;, y = &quot;電気使用量（万kw）&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>tempdata$daytime &lt;- 
  (tempdata$time &gt;= 9) &amp; (tempdata$time &lt;= 18)

tempdata &lt;- tempdata %&gt;% 
  mutate(daytime = 1 * (9 &lt;= time &amp; time &lt;= 18),
         elec100 = elec / 100,
         time12  = time %% 12,
         ampm    = ifelse(time &lt; 12, &quot;a.m.&quot;, &quot;p.m.&quot;))</code></pre>
</div>
<div id="重回帰分析-1" class="section level3">
<h3>4.3.2. 重回帰分析</h3>
</div>
<div id="rによる重回帰分析" class="section level3">
<h3>4.3.3. Rによる重回帰分析</h3>
<pre class="r"><code>lm(elec ~ temp + daytime, data = tempdata)</code></pre>
<pre><code>## 
## Call:
## lm(formula = elec ~ temp + daytime, data = tempdata)
## 
## Coefficients:
## (Intercept)         temp      daytime  
##      -69.55       116.98       555.44</code></pre>
<pre class="r"><code>lm(elec ~ temp + daytime + prec, data = tempdata)</code></pre>
<pre><code>## 
## Call:
## lm(formula = elec ~ temp + daytime + prec, data = tempdata)
## 
## Coefficients:
## (Intercept)         temp      daytime         prec  
##     -64.503      116.802      556.148       -3.366</code></pre>
<pre class="r"><code>tempdata %&gt;%
  mutate(sunday = 1 * 
           (date == &quot;2014/8/3&quot;)  |
           (date == &quot;2014/8/10&quot;) |
           (date == &quot;2014/8/17&quot;) |
           (date == &quot;2014/8/24&quot;) |
           (date == &quot;2014/8/31&quot;)) %&gt;%
  head()</code></pre>
<div class="kable-table">
<table>
<colgroup>
<col width="14%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="12%" />
<col width="12%" />
<col width="10%" />
<col width="7%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="right">time</th>
<th align="right">elec</th>
<th align="right">prec</th>
<th align="right">temp</th>
<th align="right">daytime</th>
<th align="right">elec100</th>
<th align="right">time12</th>
<th align="left">ampm</th>
<th align="left">sunday</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2014/8/1</td>
<td align="right">0</td>
<td align="right">3193</td>
<td align="right">0</td>
<td align="right">27.9</td>
<td align="right">0</td>
<td align="right">31.93</td>
<td align="right">0</td>
<td align="left">a.m.</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">2014/8/1</td>
<td align="right">1</td>
<td align="right">2960</td>
<td align="right">0</td>
<td align="right">27.9</td>
<td align="right">0</td>
<td align="right">29.60</td>
<td align="right">1</td>
<td align="left">a.m.</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">2014/8/1</td>
<td align="right">2</td>
<td align="right">2807</td>
<td align="right">0</td>
<td align="right">27.1</td>
<td align="right">0</td>
<td align="right">28.07</td>
<td align="right">2</td>
<td align="left">a.m.</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">2014/8/1</td>
<td align="right">3</td>
<td align="right">2748</td>
<td align="right">0</td>
<td align="right">26.8</td>
<td align="right">0</td>
<td align="right">27.48</td>
<td align="right">3</td>
<td align="left">a.m.</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">2014/8/1</td>
<td align="right">4</td>
<td align="right">2735</td>
<td align="right">0</td>
<td align="right">26.9</td>
<td align="right">0</td>
<td align="right">27.35</td>
<td align="right">4</td>
<td align="left">a.m.</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">2014/8/1</td>
<td align="right">5</td>
<td align="right">2736</td>
<td align="right">0</td>
<td align="right">27.3</td>
<td align="right">0</td>
<td align="right">27.36</td>
<td align="right">5</td>
<td align="left">a.m.</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>tempdata &lt;- tempdata %&gt;% 
  mutate(date = ymd(date))
tempdata %&gt;% print(n = 4)</code></pre>
<pre><code>## # A tibble: 744 x 9
##   date        time  elec  prec  temp daytime elec100 time12 ampm 
##   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;
## 1 2014-08-01     0  3193     0  27.9       0    31.9      0 a.m. 
## 2 2014-08-01     1  2960     0  27.9       0    29.6      1 a.m. 
## 3 2014-08-01     2  2807     0  27.1       0    28.1      2 a.m. 
## 4 2014-08-01     3  2748     0  26.8       0    27.5      3 a.m. 
## # ... with 740 more rows
## # i Use `print(n = ...)` to see more rows</code></pre>
<pre class="r"><code>wday(tempdata$date, label = TRUE)</code></pre>
<pre><code>##   [1] 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 土
##  [26] 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 日 日
##  [51] 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 月 月 月
##  [76] 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 火 火 火 火
## [101] 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 水 水 水 水 水
## [126] 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 木 木 木 木 木 木
## [151] 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 金 金 金 金 金 金 金
## [176] 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 土 土 土 土 土 土 土 土
## [201] 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 日 日 日 日 日 日 日 日 日
## [226] 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 月 月 月 月 月 月 月 月 月 月
## [251] 月 月 月 月 月 月 月 月 月 月 月 月 月 月 火 火 火 火 火 火 火 火 火 火 火
## [276] 火 火 火 火 火 火 火 火 火 火 火 火 火 水 水 水 水 水 水 水 水 水 水 水 水
## [301] 水 水 水 水 水 水 水 水 水 水 水 水 木 木 木 木 木 木 木 木 木 木 木 木 木
## [326] 木 木 木 木 木 木 木 木 木 木 木 金 金 金 金 金 金 金 金 金 金 金 金 金 金
## [351] 金 金 金 金 金 金 金 金 金 金 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土
## [376] 土 土 土 土 土 土 土 土 土 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日
## [401] 日 日 日 日 日 日 日 日 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月
## [426] 月 月 月 月 月 月 月 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火
## [451] 火 火 火 火 火 火 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水
## [476] 水 水 水 水 水 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木
## [501] 木 木 木 木 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金
## [526] 金 金 金 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土
## [551] 土 土 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日
## [576] 日 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月 月
## [601] 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 火 水
## [626] 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 水 木 木
## [651] 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 木 金 金 金
## [676] 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 金 土 土 土 土
## [701] 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 土 日 日 日 日 日
## [726] 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日 日
## Levels: 日 &lt; 月 &lt; 火 &lt; 水 &lt; 木 &lt; 金 &lt; 土</code></pre>
<pre class="r"><code>tempdata &lt;- tempdata %&gt;% 
  mutate(dow    = wday(date, label = TRUE),
         sunday = 1 * (dow == &quot;日&quot;))

tempdata &lt;- tempdata %&gt;% 
  mutate(recess = 1 * (&quot;2014-08-11&quot; &lt;= date &amp; 
                         date &lt;= &quot;2014-08-16&quot;))

lm(elec ~ temp + daytime + prec + sunday + recess,
   data = tempdata)</code></pre>
<pre><code>## 
## Call:
## lm(formula = elec ~ temp + daytime + prec + sunday + recess, 
##     data = tempdata)
## 
## Coefficients:
## (Intercept)         temp      daytime         prec       sunday       recess  
##      179.07       113.48       563.53        14.27      -448.39      -438.23</code></pre>
<pre class="r"><code>179.07 + 113.48 * 28 + 563.53 * 1 + 14.27 * 0 - 448.39 * 0 - 438.23 * 0</code></pre>
<pre><code>## [1] 3920.04</code></pre>
<pre class="r"><code>result &lt;- lm(elec ~ temp + daytime + prec + sunday + recess, data = tempdata)
sum(result$coefficients * c(1, 28, 1, 0, 0, 0))</code></pre>
<pre><code>## [1] 3919.964</code></pre>
</div>
<div id="補足多重共線性" class="section level3">
<h3>補足：多重共線性</h3>
</div>
</div>
<div id="決定係数と回帰分析" class="section level2">
<h2>4.4. 決定係数と回帰分析</h2>
<div id="決定計数" class="section level3">
<h3>4.4.1. 決定計数</h3>
<p>決定係数R^2</p>
</div>
<div id="決定係数の出力" class="section level3">
<h3>4.4.2. 決定係数の出力</h3>
<pre class="r"><code>lm(elec ~ temp + daytime + prec + sunday + recess,
   data = tempdata) %&gt;% 
  summary()</code></pre>
<pre><code>## 
## Call:
## lm(formula = elec ~ temp + daytime + prec + sunday + recess, 
##     data = tempdata)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -825.22 -289.33    1.57  270.66  999.57 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  179.071    114.088   1.570    0.117    
## temp         113.477      4.193  27.066   &lt;2e-16 ***
## daytime      563.528     29.716  18.964   &lt;2e-16 ***
## prec          14.275     14.701   0.971    0.332    
## sunday      -448.392     38.125 -11.761   &lt;2e-16 ***
## recess      -438.230     35.199 -12.450   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 370.3 on 738 degrees of freedom
## Multiple R-squared:  0.7331, Adjusted R-squared:  0.7313 
## F-statistic: 405.5 on 5 and 738 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>lm(elec ~ temp,
   data = tempdata) %&gt;% 
  summary()</code></pre>
<pre><code>## 
## Call:
## lm(formula = elec ~ temp, data = tempdata)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1105.11  -421.64    11.39   394.19  1065.64 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -614.272    143.223  -4.289 2.03e-05 ***
## temp         145.030      5.134  28.246  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 496.2 on 742 degrees of freedom
## Multiple R-squared:  0.5181, Adjusted R-squared:  0.5175 
## F-statistic: 797.9 on 1 and 742 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="決定係数はモデルの正しさを保証しない" class="section level3">
<h3>4.4.3. 決定係数は「モデルの正しさ」を保証しない</h3>
<pre class="r"><code>set.seed(2022) #set.seed(): 常に同じ乱数を発生, 解析ごとに結果が変わってしまうことを防止

a &lt;- sample(1:6, 15, replace = TRUE)
b &lt;- sample(1:6, 15, replace = TRUE)
c &lt;- sample(1:6, 15, replace = TRUE)
d &lt;- sample(1:6, 15, replace = TRUE)
e &lt;- sample(1:6, 15, replace = TRUE)
f &lt;- sample(1:6, 15, replace = TRUE)
g &lt;- sample(1:6, 15, replace = TRUE)

summary(lm(a ~ b + c + d + e + f + g))</code></pre>
<pre><code>## 
## Call:
## lm(formula = a ~ b + c + d + e + f + g)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.6875 -0.8476  0.2100  0.6657  1.9867 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)  5.97169    1.97662   3.021   0.0165 *
## b            0.01211    0.34577   0.035   0.9729  
## c           -0.27789    0.31640  -0.878   0.4054  
## d            0.37124    0.31947   1.162   0.2787  
## e           -0.30285    0.22822  -1.327   0.2211  
## f           -0.52931    0.27004  -1.960   0.0856 .
## g            0.30288    0.26822   1.129   0.2915  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.328 on 8 degrees of freedom
## Multiple R-squared:  0.618,  Adjusted R-squared:  0.3316 
## F-statistic: 2.157 on 6 and 8 DF,  p-value: 0.1552</code></pre>
<ul>
<li>過剰適合（overfitting）, 過学習</li>
<li>どの説明変数をモデルに含めるべきか？
<ul>
<li>先験的モデル</li>
<li>「モデル推定用」標本と「モデル検証用」標本</li>
<li>情報量基準 e.g. Akaike Information Criterion: AIC</li>
</ul></li>
</ul>
</div>
</div>
<div id="補足-残差の性質と回帰係数の計算公式" class="section level2">
<h2>補足: 残差の性質と回帰係数の計算公式</h2>
<pre class="r"><code>tempdata &lt;- read_csv(&quot;temperature_aug.csv&quot;)</code></pre>
<pre><code>## Rows: 744 Columns: 5
## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## chr (1): date
## dbl (4): time, elec, prec, temp
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>result &lt;- lm(elec ~ temp,
             data = tempdata)
ehat &lt;- result$residuals
sum(ehat)</code></pre>
<pre><code>## [1] 2.615153e-11</code></pre>
<pre class="r"><code>sum(tempdata$temp*ehat)</code></pre>
<pre><code>## [1] 1.093596e-09</code></pre>
</div>
</div>
<div id="練習問題" class="section level1">
<h1>練習問題</h1>
<div id="問題4.1." class="section level2">
<h2>問題4.1.</h2>
<pre class="r"><code>library(dplyr)
library(lubridate)
library(broom)</code></pre>
<pre><code>## Warning: パッケージ &#39;broom&#39; はバージョン 4.1.3 の R の下で造られました</code></pre>
<pre class="r"><code>elecdata &lt;- read.csv(&quot;temperature_aug.csv&quot;)</code></pre>
<div id="問題4.1.1." class="section level3">
<h3>問題4.1.1.</h3>
<pre class="r"><code>elecdata &lt;- read.csv(&quot;temperature_aug.csv&quot;)
elecdata &lt;- elecdata %&gt;%
  mutate(morning = 1 * (6 &lt;= time &amp; time &lt;= 12), 
         afternoon = 1 * (13 &lt;= time &amp; time &lt;= 18))
elecdata %&gt;%
  select(time, morning, afternoon) %&gt;%
  head()</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">time</th>
<th align="right">morning</th>
<th align="right">afternoon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="問題4.1.2." class="section level3">
<h3>問題4.1.2.</h3>
<pre class="r"><code>elecdata &lt;- elecdata %&gt;%
  mutate(date = ymd(date), 
         dow  = wday(date, label = TRUE),
         saturday = 1 * (dow == &quot;土&quot;))</code></pre>
</div>
<div id="問題4.1.3." class="section level3">
<h3>問題4.1.3.</h3>
<pre class="r"><code>elecdata &lt;- elecdata %&gt;%
  mutate(sunday = 1*(dow == &quot;日&quot;), 
         recess = 1*(&quot;2014-08-11&quot; &lt;= date &amp; date &lt;= &quot;2014-08-16&quot;))
elecdata %&gt;%
  lm(elec ~ temp + prec + sunday +
       recess + morning + afternoon + saturday, data =.) %&gt;%
  tidy()</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">88.88949</td>
<td align="right">119.530477</td>
<td align="right">0.7436555</td>
<td align="right">0.4573223</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">119.71173</td>
<td align="right">4.357246</td>
<td align="right">27.4741703</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">prec</td>
<td align="right">25.19906</td>
<td align="right">15.336192</td>
<td align="right">1.6431105</td>
<td align="right">0.1007872</td>
</tr>
<tr class="even">
<td align="left">sunday</td>
<td align="right">-497.75053</td>
<td align="right">40.694668</td>
<td align="right">-12.2313452</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">recess</td>
<td align="right">-446.60967</td>
<td align="right">36.747890</td>
<td align="right">-12.1533417</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">morning</td>
<td align="right">201.87023</td>
<td align="right">34.799579</td>
<td align="right">5.8009388</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">afternoon</td>
<td align="right">571.84483</td>
<td align="right">37.086540</td>
<td align="right">15.4192015</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">saturday</td>
<td align="right">-256.12187</td>
<td align="right">39.715761</td>
<td align="right">-6.4488722</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="問題4.1.4." class="section level3">
<h3>問題4.1.4.</h3>
<pre class="r"><code>elecdata %&gt;%
  lm(elec ~ temp + prec + sunday +
       recess + morning + afternoon + saturday,
     data = .) %&gt;%
  glance() %&gt;%
  pull(r.squared)</code></pre>
<pre><code>## [1] 0.7103612</code></pre>
</div>
</div>
<div id="問題4.2." class="section level2">
<h2>問題4.2.</h2>
<div id="問題4.2.1." class="section level3">
<h3>問題4.2.1.</h3>
<pre class="r"><code>icedata &lt;- read.csv(&quot;icecream.csv&quot;)

icedata %&gt;%
  ggplot(aes(x = income, y = icecream)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  labs(title = &quot;問題4.2.1　回帰直線（アイスクリームの年間消費額 ~ 年間所得）&quot;, 
       x = &quot;年間所得（円）&quot;, y = &quot;アイスクリームの年間消費額（円）&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="問題4.2.2." class="section level3">
<h3>問題4.2.2.</h3>
<pre class="r"><code>icedata &lt;- read.csv(&quot;icecream.csv&quot;)

icedata %&gt;%
  lm(icecream ~ income + u15, data =.) %&gt;%
  glance %&gt;%
  pull(r.squared)</code></pre>
<pre><code>## [1] 0.2040664</code></pre>
</div>
</div>
<div id="問題4.3." class="section level2">
<h2>問題4.3.</h2>
<pre class="r"><code>wagedata &lt;- read.csv(&quot;wage.csv&quot;)</code></pre>
<div id="問題4.3.1." class="section level3">
<h3>問題4.3.1.</h3>
<pre class="r"><code>wagedata &lt;- read.csv(&quot;wage.csv&quot;)
wagedata %&gt;%
  lm(log(wage) ~ educ, data =.) %&gt;%
  augment() %&gt;%
  ggplot(aes(x = educ, y = `log(wage)`)) +
  geom_point() +
  geom_line(colour = &quot;blue&quot;, aes(y = .fitted)) +
  labs(title = &quot;問題4.3.1　回帰直線（賃金（時給） ~ 教育を受けた年数）&quot;, 
       x = &quot;教育を受けた年数（年）&quot;, y = &quot;賃金（時給）（円）&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))</code></pre>
<p><img src="rweek4_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="問題4.3.2." class="section level3">
<h3>問題4.3.2.</h3>
<pre class="r"><code>wagedata &lt;- read.csv(&quot;wage.csv&quot;)
wagedata %&gt;%
  lm(log(wage) ~ educ + exper, data = .) %&gt;%
  tidy()</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">4.6660344</td>
<td align="right">0.0637900</td>
<td align="right">73.14680</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">educ</td>
<td align="right">0.0931680</td>
<td align="right">0.0036118</td>
<td align="right">25.79581</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">exper</td>
<td align="right">0.0406574</td>
<td align="right">0.0023344</td>
<td align="right">17.41658</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<footer>
  <p>Copyright &copy; 2023- Naoshi ISAKI </p>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
